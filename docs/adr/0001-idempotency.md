# ADR 0001: Идемпотентность переноса

## Контекст
Перенос плейлистов выполняется пакетно, с возможностью повторного запуска. Необходимо обеспечить отсутствие дублей и корректное восстановление после сбоев.

## Решение
- Идентификатор идемпотентности: `(userId, source, target, snapshotHash)`.
- `snapshotHash` вычисляется из детерминированного списка исходных треков (title, artists, durationMs, isrc?), нормализованных по правилам матчинга.
- Чекпойнты на уровне батча: `BatchCheckpoint{jobId, batchIdx, stage, cursor, attempts}`.
- Повторный запуск с тем же ключом выполняет reconcile и не создаёт дубликатов.

## Последствия
- Требуется стабильная нормализация и стабильный порядок треков.
- Хранение чекпойнтов и отчётов вне процесса.
- Лёгкий аудит: отчёт содержит причины `not_found` и метаданные батчей.


